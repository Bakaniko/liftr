---
title: "A Quick Introduction to liftr"
author: "Nan Xiao <<https://nanx.me>>"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
    css: liftr.css
    includes:
      in_header: header.html
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{A Quick Introduction to liftr}
---

# Introduction

In essence, liftr aims to solve the problem of _persistent reproducible reporting_. To achieve this goal, it extends the [R Markdown](http://rmarkdown.rstudio.com) metadata format, and uses [Docker](https://www.docker.com) to containerize and render R Markdown documents.

# Metadata for Containerization

To containerize your R Markdown document, the first step is adding `liftr` options in the YAML front-matter of a document. For example:

```yaml
---
title: "The Missing Example of liftr"
author: "Author Name"
date: "`r Sys.Date()`"
output:
  html_document:
    highlight: haddock
    theme: readable
liftr:
  maintainer: "Author Name"
  maintainer_email: "name@example.com"
  from: "rocker/r-base:latest"
  latex: false
  pandoc: true
  syslib:
    - gfortran
    - samtools
  cranpkg:
    - randomForest
  biocpkg:
    - Gviz
    - ggbio
  ghpkg:
    - "road2stat/liftr"
---
```

All available metadata fields are expained below.

## Required metadata

- `maintainer`

    Maintainer name for the Dockerfile.

- `maintainer_email`

    Maintainer email address for the Dockerfile.

## Optional metadata

- `from`

    [Base image](https://docs.docker.com/reference/builder/#from) for
    building the docker image. Default is `"rocker/r-base:latest"`.

- `latex`

    Is TeX environment needed when rendering the document? Default is `false`.

- `pandoc`

    Should we install pandoc in the container? Default is `true`.

    If pandoc was already installed in the base image, this should be
    set to `false` to avoid potential errors. For example, for
    [`rocker/rstudio` images](https://registry.hub.docker.com/u/rocker/rstudio/)
    and [`bioconductor/...` images](https://www.bioconductor.org/help/docker/),
    this option will be automatically set to `false` since they already
    have pandoc installed.

- `syslib`

    Debian/Ubuntu system software packages depended in the document.

    Please also include software packages depended by the R packages
    included below, such as `gfortran` here required for compiling
    `randomForest`.

- `cranpkg`

    CRAN packages depended in the document.

    If only `pkgname` is provided, `liftr` will install the _latest_
    version of the package on CRAN. To improve reproducibility,
    we recommend to use the package name with a specified version number:
    `pkgname/pkgversion` (e.g. `ggplot2/1.0.0`), even if the version
    is the current latest version. Note: `pkgversion` must be provided
    to install the archived versions of packages.

- `biocpkg`

    Bioconductor packages depended in the document.

- `ghpkg`

    GitHub R packages depended in the document.

    We accept the same format as the `repo` argument in
    `devtools::install_github`. Normally, `"username/repo"` is sufficient.

# Containerize the Document

After adding proper `liftr` metadata to the document YAML data block, we can use `lift()` to parse the document and generate a Dockerfile.

We will use [a minimal example](https://github.com/road2stat/liftr/blob/master/inst/examples/liftr-minimal.Rmd) included in the liftr package. First, we create a new directory and copy the R Markdown document into the directory:

```{r, eval = FALSE}
dir_example = "~/liftr-minimal/"
dir.create(dir_example)
file.copy(system.file("examples/liftr-minimal.Rmd", package = "liftr"), dir_example)
```

Then, we use `lift()` to parse the document and generate the Dockerfile:

```{r, eval = FALSE}
library("liftr")

input = paste0(dir_example, "liftr-minimal.Rmd")
lift(input)
```

After successfully running `lift()`, the Dockerfile will be in the `~/liftr-minimal/` directory.

# Render the Document

Now we can use `render_docker()` to render the document into an HTML file, under a Docker container:

```{r, eval = FALSE}
render_docker(input)
```

The function `render_docker()` will parse the Dockerfile, build a new Docker image, and run a Docker container to render the input document. If successfully rendered, the output `liftr-minimal.html` will be in the `~/liftr-minimal/` directory. You can also pass additional arguments in `rmarkdown::render` to this function.

In order to share the dockerized R Markdown document, simply share the `.Rmd` file. Other users can use the `lift()` and `render_docker()` functions to render the document as above.

# Cleaning Up

To clean up the (unused) Docker image after sucessful rendering, you can use `purge_image()`:

```{r, eval = FALSE}
purge_image(paste0(dir_example, "liftr-minimal.docker.yml"))
```

The above input YAML file contains the basic information of the Docker container, image, and commands to render the document. It is generated by setting `purge_info = TRUE` (default) in `render_docker()`.

# System Requirements

Docker is an essential system requirement when using liftr to render the R Markdown documents. Besides Linux, Docker Engine has a much improved near-native support for Mac and Windows since 2016, so there should not be a problem if you use the officially recommended installation. If not, simply make sure that you can run `docker` under shell. For example, to install Docker under Ubuntu:

```bash
sudo apt-get install docker.io
```

We should configure Docker to [run without sudo](https://docs.docker.com/installation/ubuntulinux/#create-a-docker-group). To avoid `sudo` when using the `docker` command, simply create a group named `docker` and add yourself to it:

```bash
sudo usermod -aG docker your-username
```

Here is a [detailed guide]((https://docs.docker.com/installation/)) for installing Docker on the other platforms.

<hr>

Project website: [https://liftr.me](https://liftr.me)
